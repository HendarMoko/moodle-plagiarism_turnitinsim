{"version":3,"sources":["../src/cv_launch.js"],"names":["define","$","open_cv","document","on","classList","parent","attr","split","submissionid","each","index","match","dvWindow","window","open","loading","icon","M","cfg","wwwroot","loadingCvStr","str","plagiarism_turnitinsim","loadingcv","body","html","ajax","type","url","dataType","data","action","sesskey","success","location","viewer_url","checkDVClosed","that","closed","setTimeout"],"mappings":"AA4BAA,OAAM,oCAAC,CAAC,QAAD,CAAD,CAAa,SAASC,CAAT,CAAY,CAC3B,MAAO,CACHC,OAAO,CAAE,kBAAW,CAChBD,CAAC,CAACE,QAAD,CAAD,CAAYC,EAAZ,CAAe,OAAf,CAAwB,WAAxB,CAAqC,UAAW,IAGxCC,CAAAA,CAAS,CAAGJ,CAAC,CAAC,IAAD,CAAD,CAAQK,MAAR,GAAiBC,IAAjB,CAAsB,OAAtB,EAA+BC,KAA/B,CAAqC,KAArC,CAH4B,CAIxCC,CAAY,CAAG,CAJyB,CAK5CR,CAAC,CAACI,CAAD,CAAD,CAAaK,IAAb,CAAkB,SAASC,CAAT,CAAe,CAC7B,GAAIN,CAAS,CAACM,CAAD,CAAT,CAAiBC,KAAjB,CAAuB,cAAvB,CAAJ,CAA4C,CACxCH,CAAY,CAAGJ,CAAS,CAACM,CAAD,CAAT,CAAiBH,KAAjB,CAAuB,GAAvB,EAA4B,CAA5B,CAClB,CACJ,CAJD,EAL4C,GAaxCK,CAAAA,CAAQ,CAAGC,MAAM,CAACC,IAAP,CAAY,EAAZ,CAAgB,UAAhB,CAb6B,CAcxCC,CAAO,CAAG,6DAd8B,CAexCC,CAAI,CAAGC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,yCAfiB,CAgB5CJ,CAAO,EAAI,cAAeC,CAAf,CAAsB,0CAAjC,CACA,GAAII,CAAAA,CAAY,CAAGH,CAAC,CAACI,GAAF,CAAMC,sBAAN,CAA6BC,SAAhD,CACAR,CAAO,EAAI,2DAA2DK,CAA3D,CAA0E,MAArF,CACAL,CAAO,EAAI,QAAX,CACAf,CAAC,CAACY,CAAQ,CAACV,QAAT,CAAkBsB,IAAnB,CAAD,CAA0BC,IAA1B,CAA+BV,CAA/B,EAEAf,CAAC,CAAC0B,IAAF,CAAO,CACHC,IAAI,CAAE,KADH,CAEHC,GAAG,CAAEX,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,qCAFlB,CAGHU,QAAQ,CAAE,MAHP,CAIHC,IAAI,CAAE,CACFC,MAAM,CAAE,mBADN,CAEFvB,YAAY,CAAEA,CAFZ,CAGFwB,OAAO,CAAEf,CAAC,CAACC,GAAF,CAAMc,OAHb,CAJH,CASHC,OAAO,CAAE,iBAASH,CAAT,CAAe,CAEpBlB,CAAQ,CAACsB,QAAT,CAAoBJ,CAAI,CAACK,UAAzB,CACA,KAAKC,aAAL,CAAmBxB,CAAnB,CACH,CAbE,CAcHwB,aAAa,CAAE,uBAASxB,CAAT,CAAmB,CAC9B,GAAIyB,CAAAA,CAAI,CAAG,IAAX,CACA,GAAIzB,CAAQ,CAAC0B,MAAb,CAAqB,CACjBzB,MAAM,CAACqB,QAAP,CAAkBrB,MAAM,CAACqB,QAC5B,CAFD,IAEO,CACHK,UAAU,CAAC,UAAW,CAClBF,CAAI,CAACD,aAAL,CAAmBxB,CAAnB,CACH,CAFS,CAEP,GAFO,CAGb,CACJ,CAvBE,CAAP,CAyBH,CA/CD,CAgDH,CAlDE,CAoDV,CArDK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the Turnitin Cloud Viewer launch.\n *\n * @package   plagiarism_turnitinsim\n * @copyright 2017 Turnitin\n * @author    John McGettrick <jmcgettrick@turnitin.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module plagiarism_turnitinsim/cv_launch\n */\n\ndefine(['jquery'], function($) {\n    return {\n        open_cv: function() {\n            $(document).on('click', '.or_score', function() {\n\n                // Moodle forums strip ids from elements so we have to use classes.\n                var classList = $(this).parent().attr('class').split(/\\s+/);\n                var submissionid = 0;\n                $(classList).each(function(index){\n                    if (classList[index].match(\"^submission_\")) {\n                        submissionid = classList[index].split(\"_\")[1];\n                    }\n                });\n\n                // Launch the Cloud Viewer in a new window.\n                // It is being done this way as in the future we may have to listen for it closing and act on it.\n                var dvWindow = window.open('', 'cvWindow');\n                var loading = '<div class=\"tii_dv_loading\" style=\"text-align:center;\">';\n                var icon = M.cfg.wwwroot + '/plagiarism/turnitinsim/pix/tiiIcon.svg';\n                loading += '<img src=\"' + icon + '\" style=\"width:100px; height: 100px\">';\n                var loadingCvStr = M.str.plagiarism_turnitinsim.loadingcv;\n                loading += '<p style=\"font-family: Arial, Helvetica, sans-serif;\">' + loadingCvStr + '</p>';\n                loading += '</div>';\n                $(dvWindow.document.body).html(loading);\n\n                $.ajax({\n                    type: \"GET\",\n                    url: M.cfg.wwwroot + \"/plagiarism/turnitinsim/ajax/cv.php\",\n                    dataType: \"json\",\n                    data: {\n                        action: 'request_cv_launch',\n                        submissionid: submissionid,\n                        sesskey: M.cfg.sesskey\n                    },\n                    success: function(data) {\n                        // Redirect opened window to returned URL.\n                        dvWindow.location = data.viewer_url;\n                        this.checkDVClosed(dvWindow);\n                    },\n                    checkDVClosed: function(dvWindow) {\n                        var that = this;\n                        if (dvWindow.closed) {\n                            window.location = window.location;\n                        } else {\n                            setTimeout(function() {\n                                that.checkDVClosed(dvWindow);\n                            }, 500);\n                        }\n                    }\n                });\n            });\n        }\n    };\n});"],"file":"cv_launch.min.js"}